"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[341],{193:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"docs/developer-resources/api/api-containerization","title":"API Plugin Containerization","description":"This section uses the exact setup from the T5 Summarizer plugin for containerization.","source":"@site/docs/docs/developer-resources/api/containerization.md","sourceDirName":"docs/developer-resources/api","slug":"/developer-resources/api/containerization","permalink":"/docs/developer-resources/api/containerization","draft":false,"unlisted":false,"editUrl":"https://github.com/PalisadoesFoundation/talawa-plugin/edit/develop/docs/docs/docs/developer-resources/api/containerization.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"api-containerization","title":"API Plugin Containerization","slug":"/developer-resources/api/containerization","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"API Plugin Development Introduction","permalink":"/docs/developer-resources/api/introduction"},"next":{"title":"development","permalink":"/docs/docs/developer-resources/api/development"}}');var t=i(6070),o=i(7648);const s={id:"api-containerization",title:"API Plugin Containerization",slug:"/developer-resources/api/containerization",sidebar_position:3},a="API Plugin Containerization (T5 Summarizer Reference)",l={},c=[{value:"Quick Start",id:"quick-start",level:2},{value:"1. Build and Run with Docker Compose",id:"1-build-and-run-with-docker-compose",level:3},{value:"2. Using the API",id:"2-using-the-api",level:3},{value:"Docker Compose Example",id:"docker-compose-example",level:2},{value:"Lifecycle Integration",id:"lifecycle-integration",level:3},{value:"Multi-Container Setup",id:"multi-container-setup",level:2},{value:"Redis + Worker Example",id:"redis--worker-example",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Health Checks",id:"health-checks",level:2},{value:"Container Health",id:"container-health",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 Do&#39;s",id:"-dos",level:3},{value:"\u274c Don&#39;ts",id:"-donts",level:3},{value:"Optimization",id:"optimization",level:2},{value:"Image Size",id:"image-size",level:3},{value:"Caching",id:"caching",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Container Won&#39;t Start",id:"container-wont-start",level:3},{value:"Out of Memory",id:"out-of-memory",level:3},{value:"Slow Performance",id:"slow-performance",level:3},{value:"Resources",id:"resources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"api-plugin-containerization-t5-summarizer-reference",children:"API Plugin Containerization (T5 Summarizer Reference)"})}),"\n",(0,t.jsx)(n.p,{children:"This section uses the exact setup from the T5 Summarizer plugin for containerization."}),"\n",(0,t.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsx)(n.h3,{id:"1-build-and-run-with-docker-compose",children:"1. Build and Run with Docker Compose"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose up --build\n# The API will be available at http://localhost:8000\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-using-the-api",children:"2. Using the API"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Health check\ncurl http://localhost:8000/health\n\n# Summarize text\ncurl -X POST "http://localhost:8000/summarize" \\\n     -H "Content-Type: application/json" \\\n     -d \'{"text": "Your long text here...", "max_summary_length": 150}\'\n'})}),"\n",(0,t.jsx)(n.h2,{id:"docker-compose-example",children:"Docker Compose Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"services:\n  t5-summarizer:\n    build: .\n    container_name: t5-summarizer\n    ports:\n      - \"8000:8000\"\n    volumes:\n      - cache:/app/cache\n      - input:/app/input\n      - output:/app/output\n\n      }\n    },\n  })\n);\n\nbuilder.objectType('SummarizeResult', {\n  fields: (t) => ({\n    summary: t.exposeString('summary'),\n    originalLength: t.exposeInt('originalLength'),\n    summaryLength: t.exposeInt('summaryLength'),\n  }),\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"lifecycle-integration",children:"Lifecycle Integration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// index.ts\nimport { IPluginLifecycle } from '../../types';\nimport { execSync } from 'child_process';\nimport axios from 'axios';\n\nconst SummarizeT5Plugin: IPluginLifecycle = {\n  async onInstall() {\n    console.log('[SummarizeT5] Building Docker container...');\n    \n    // Build container\n    execSync('docker-compose -f container/docker-compose.yml build', {\n      cwd: __dirname,\n      stdio: 'inherit',\n    });\n  },\n\n  async onActivate() {\n    console.log('[SummarizeT5] Starting container...');\n    \n    // Start container\n    execSync('docker-compose -f container/docker-compose.yml up -d', {\n      cwd: __dirname,\n      stdio: 'inherit',\n    });\n\n    // Wait for health check\n    await waitForHealthy('http://localhost:8000/health', 60000);\n    \n    console.log('[SummarizeT5] Container ready');\n  },\n\n  async onDeactivate() {\n    console.log('[SummarizeT5] Stopping container...');\n    \n    // Stop container\n    execSync('docker-compose -f container/docker-compose.yml down', {\n      cwd: __dirname,\n      stdio: 'inherit',\n    });\n  },\n\n  async onUninstall() {\n    console.log('[SummarizeT5] Removing container and volumes...');\n    \n    // Remove everything\n    execSync('docker-compose -f container/docker-compose.yml down -v --rmi all', {\n      cwd: __dirname,\n      stdio: 'inherit',\n    });\n  },\n};\n\nasync function waitForHealthy(url: string, timeout: number): Promise<void> {\n  const start = Date.now();\n  \n  while (Date.now() - start < timeout) {\n    try {\n      const response = await axios.get(url);\n      if (response.data.status === 'healthy') {\n        return;\n      }\n    } catch (error) {\n      // Not ready yet\n    }\n    \n    await new Promise(resolve => setTimeout(resolve, 1000));\n  }\n  \n  throw new Error('Container health check timeout');\n}\n\nexport default SummarizeT5Plugin;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"multi-container-setup",children:"Multi-Container Setup"}),"\n",(0,t.jsx)(n.h3,{id:"redis--worker-example",children:"Redis + Worker Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# docker-compose.yml\nservices:\n  redis:\n    image: redis:7-alpine\n    container_name: plugin-redis\n    ports:\n      - "6379:6379"\n    volumes:\n      - redis-data:/data\n    command: redis-server --appendonly yes\n    healthcheck:\n      test: ["CMD", "redis-cli", "ping"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  worker:\n    build: ./worker\n    container_name: plugin-worker\n    depends_on:\n      redis:\n        condition: service_healthy\n    environment:\n      - REDIS_URL=redis://redis:6379\n      - WORKER_CONCURRENCY=4\n    volumes:\n      - ./jobs:/app/jobs\n    restart: unless-stopped\n\nvolumes:\n  redis-data:\n'})}),"\n",(0,t.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# .env (plugin-specific)\n# T5 Model Configuration\nMODEL_NAME=t5-base\nMAX_LENGTH=512\nMIN_LENGTH=50\nBATCH_SIZE=4\n\n# Container Resources\nMEMORY_LIMIT=4G\nCPU_LIMIT=2.0\n\n# Service Configuration\nSERVICE_PORT=8000\nLOG_LEVEL=info\n"})}),"\n",(0,t.jsx)(n.h2,{id:"health-checks",children:"Health Checks"}),"\n",(0,t.jsx)(n.h3,{id:"container-health",children:"Container Health"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'@app.get("/health")\nasync def health_check():\n    """Comprehensive health check"""\n    try:\n        # Check model loaded\n        if model is None:\n            return {"status": "unhealthy", "reason": "Model not loaded"}\n        \n        # Check device availability\n        if device == "cuda" and not torch.cuda.is_available():\n            return {"status": "degraded", "reason": "GPU not available"}\n        \n        # Test summarization\n        test_input = tokenizer.encode("test", return_tensors="pt").to(device)\n        model.generate(test_input, max_length=10)\n        \n        return {\n            "status": "healthy",\n            "model": model_name,\n            "device": device,\n            "memory_allocated": torch.cuda.memory_allocated() if device == "cuda" else None\n        }\n    except Exception as e:\n        return {"status": "unhealthy", "error": str(e)}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"-dos",children:"\u2705 Do's"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use multi-stage builds to reduce image size"}),"\n",(0,t.jsx)(n.li,{children:"Implement health checks"}),"\n",(0,t.jsx)(n.li,{children:"Set resource limits"}),"\n",(0,t.jsx)(n.li,{children:"Use volume mounts for persistent data"}),"\n",(0,t.jsx)(n.li,{children:"Implement graceful shutdown"}),"\n",(0,t.jsx)(n.li,{children:"Add proper logging"}),"\n",(0,t.jsx)(n.li,{children:"Monitor container health"}),"\n",(0,t.jsx)(n.li,{children:"Use environment variables for configuration"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"-donts",children:"\u274c Don'ts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Don't store secrets in Docker images"}),"\n",(0,t.jsx)(n.li,{children:"Don't run as root user"}),"\n",(0,t.jsxs)(n.li,{children:["Don't use ",(0,t.jsx)(n.code,{children:"latest"})," tag in production"]}),"\n",(0,t.jsx)(n.li,{children:"Don't ignore resource limits"}),"\n",(0,t.jsx)(n.li,{children:"Don't skip health checks"}),"\n",(0,t.jsx)(n.li,{children:"Don't expose unnecessary ports"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"optimization",children:"Optimization"}),"\n",(0,t.jsx)(n.h3,{id:"image-size",children:"Image Size"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dockerfile",children:'# Multi-stage build\nFROM python:3.9-slim as builder\n\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --user --no-cache-dir -r requirements.txt\n\nFROM python:3.9-slim\n\nWORKDIR /app\nCOPY --from=builder /root/.local /root/.local\nCOPY . .\n\nENV PATH=/root/.local/bin:$PATH\nCMD ["python", "server.py"]\n'})}),"\n",(0,t.jsx)(n.h3,{id:"caching",children:"Caching"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"from functools import lru_cache\n\n@lru_cache(maxsize=100)\ndef get_summary_cached(text_hash: str, max_length: int):\n    # Cache summaries\n    return summarize(text, max_length)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"container-wont-start",children:"Container Won't Start"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check logs\ndocker-compose logs t5-summarizer\n\n# Check resource usage\ndocker stats\n\n# Inspect container\ndocker inspect t5-summarizer\n"})}),"\n",(0,t.jsx)(n.h3,{id:"out-of-memory",children:"Out of Memory"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Increase memory limit\ndeploy:\n  resources:\n    limits:\n      memory: 8G\n"})}),"\n",(0,t.jsx)(n.h3,{id:"slow-performance",children:"Slow Performance"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use GPU if available"}),"\n",(0,t.jsx)(n.li,{children:"Batch requests"}),"\n",(0,t.jsx)(n.li,{children:"Reduce model size"}),"\n",(0,t.jsx)(n.li,{children:"Implement caching"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.docker.com",children:"Docker Documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.docker.com/compose/",children:"Docker Compose"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://fastapi.tiangolo.com",children:"FastAPI"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://huggingface.co/docs/transformers/",children:"Hugging Face Transformers"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},7648:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>a});var r=i(758);const t={},o=r.createContext(t);function s(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);